<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Status (Variable Logic Applied)</title>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        :root {
            --c-yura: #ff4757;
            --c-mina: #3742fa;
            --c-minji: #a55eea;
            --c-serin: #2ed573;
            --bg-gray: #f1f2f6;
            --text-main: #2f3542;
            --border-color: #dcdde1;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: #ced6e0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Pretendard', sans-serif;
            user-select: none;
        }

        /* 400x600 ë©”ì¸ í”„ë ˆì„ -> í¬ê¸° í™•ì¥ */
        .device-frame {
            width: 450px; /* ë„ˆë¹„ ì¦ê°€ */
            height: 800px; /* ë†’ì´ ëŒ€í­ ì¦ê°€ */
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.25);
            display: flex;
            overflow: hidden;
            position: relative;
            border: 4px solid #fff;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 60px;
            height: 100%;
            background-color: #f1f2f6;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            z-index: 20;
        }

        .tab-btn {
            width: 100%; height: 60px;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            cursor: pointer; color: #a4b0be; transition: 0.2s;
            border-bottom: 1px solid #e1e2e6;
        }
        .tab-btn span { font-size: 1.1rem; font-weight: 800; }
        .tab-btn small { font-size: 0.55rem; margin-top: 2px; }
        
        .tab-btn.active { background: #fff; width: 61px; margin-right: -1px; color: var(--text-main); }
        .tab-btn[data-target="yura"].active { color: var(--c-yura); border-left: 4px solid var(--c-yura); }
        .tab-btn[data-target="mina"].active { color: var(--c-mina); border-left: 4px solid var(--c-mina); }
        .tab-btn[data-target="minji"].active { color: var(--c-minji); border-left: 4px solid var(--c-minji); }
        .tab-btn[data-target="serin"].active { color: var(--c-serin); border-left: 4px solid var(--c-serin); }

        /* ì½˜í…ì¸  ì˜ì—­ */
        .content-area { flex: 1; position: relative; background: #fff; display: flex; flex-direction: column; }
        
        .char-panel {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            opacity: 0; visibility: hidden; transition: 0.2s;
        }
        .char-panel.active { opacity: 1; visibility: visible; }

        /* ğŸ–¼ï¸ ì´ë¯¸ì§€ ë·°ì–´ (Hover Reveal ì ìš©) */
        .img-viewport {
            height: 500px; /* ì´ë¯¸ì§€ ì˜ì—­ ëŒ€í­ í™•ëŒ€ */
            width: 100%;
            background-color: #fff;
            position: relative;
            border-bottom: 1px solid var(--border-color);
            cursor: zoom-in;
            z-index: 10;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .char-img {
            width: 100%; height: 100%;
            object-fit: contain; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì „ì²´ í‘œì‹œ */
            object-position: center;
            transition: all 0.3s ease; background: #fff;
        }
        .img-viewport:hover {
            height: 100%; position: absolute; top: 0; left: 0;
            z-index: 100; border-bottom: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .img-viewport:hover .char-img {
            object-fit: contain; object-position: center;
            background-color: rgba(255,255,255,0.98); padding: 10px;
        }

        /* í…ìŠ¤íŠ¸ ì •ë³´ ì˜¤ë²„ë ˆì´ */
        .name-tag {
            position: absolute; top: 12px; left: 12px;
            background: rgba(0, 0, 0, 0.6); color: #fff;
            padding: 4px 12px; border-radius: 20px;
            font-size: 0.8rem; font-weight: 700;
            z-index: 101; pointer-events: none;
        }
        
        /* í–‰ë™/ê°ì • í‘œì‹œë°” (ì´ë¯¸ì§€ í•˜ë‹¨) */
        .action-bar {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: rgba(255,255,255,0.9);
            padding: 8px 12px;
            border-top: 1px solid rgba(0,0,0,0.05);
            font-size: 0.8rem; font-weight: 600; color: #2f3542;
            display: flex; justify-content: space-between; align-items: center;
            transition: opacity 0.2s;
        }
        .img-viewport:hover .action-bar { opacity: 0; } /* ì¤Œì¸ ì‹œ ìˆ¨ê¹€ */

        /* ìƒíƒœì°½ ì„¹ì…˜ */
        .status-section {
            padding: 12px;
            background: #fff;
            border-bottom: 1px solid var(--border-color);
        }

        /* ì¥ì†Œ ì´ë™ */
        .location-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 8px; background: #f8f9fa; padding: 8px 12px;
            border-radius: 8px; border: 1px solid var(--border-color);
        }
        .loc-text { font-size: 0.85rem; font-weight: 700; color: #2f3542; }
        .btn-move {
            background: #2f3542; color: #fff; border: none; padding: 6px 12px;
            border-radius: 6px; font-size: 0.75rem; font-weight: bold;
            cursor: pointer;
        }
        .yura .btn-move { background: var(--c-yura); }
        .mina .btn-move { background: var(--c-mina); }
        .minji .btn-move { background: var(--c-minji); }

        /* ìˆ˜ì¹˜ ê·¸ë¦¬ë“œ */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; text-align: center; }
        .stat-box { background: #fff; border: 1px solid var(--border-color); border-radius: 6px; padding: 6px 4px; }
        .s-label { display: block; font-size: 0.65rem; color: #a4b0be; margin-bottom: 3px; font-weight: 600; }
        
        /* ê°’ í‘œì‹œ ë””ìì¸ */
        .s-val { font-size: 0.8rem; font-weight: 700; color: #2f3542; display: flex; justify-content: center; align-items: center; gap: 4px; }
        .s-val.dual { font-size: 0.75rem; } /* ë‘ ê°œ í‘œì‹œë  ë•Œ í°íŠ¸ ì‘ê²Œ */
        .v-u { color: #ff4757; } .v-n { color: #2f3542; }
        .emoji { font-size: 0.9rem; margin-right: 2px; }

        /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel { flex: 1; display: flex; flex-direction: column; background: #fdfdfd; overflow: hidden; }
        .mode-switch { display: flex; border-bottom: 1px solid var(--border-color); background: #f1f2f6; }
        .mode-btn {
            flex: 1; padding: 12px; text-align: center; font-size: 0.85rem; font-weight: 700;
            color: #a4b0be; cursor: pointer; transition: 0.2s;
        }
        .mode-btn.active { background: #fff; color: #2f3542; border-bottom: 3px solid #2f3542; }

        .code-list-container {
            flex: 1; overflow-y: auto; padding: 10px;
            display: flex; flex-wrap: wrap; align-content: flex-start; gap: 6px;
        }
        .chip-btn {
            padding: 6px 12px; font-size: 0.75rem; background: #fff;
            border: 1px solid #dcdde1; border-radius: 16px; cursor: pointer;
            color: #57606f; transition: 0.1s; font-weight: 600;
        }
        .chip-btn.active { background: #2f3542; color: #fff; border-color: #2f3542; }
        .chip-btn.nsfw { border-color: #fab1a0; color: #d63031; background: #fff0f0; }
        .chip-btn.nsfw.active { background: #d63031; color: #fff; }

    </style>
</head>
<body>

    <div class="device-frame">
        <nav class="sidebar">
            <div class="tab-btn active" onclick="changeChar('yura')" data-target="yura"><span>A</span><small>A1</small></div>
            <div class="tab-btn" onclick="changeChar('mina')" data-target="mina"><span>B</span><small>A2</small></div>
            <div class="tab-btn" onclick="changeChar('minji')" data-target="minji"><span>C</span><small>A3</small></div>
            <div class="tab-btn" onclick="changeChar('serin')" data-target="serin"><span>D</span><small>A4</small></div>
        </nav>

        <main class="content-area">
            
            <div id="main-panel" class="char-panel active yura">
                
                <!-- ìƒë‹¨ ì´ë¯¸ì§€ -->
                <div class="img-viewport">
                    <div class="name-tag" id="disp-name">ìµœìœ ë¼ (A1)</div>
                    <img id="disp-img" class="char-img" src="" alt="Character">
                    
                    <!-- í–‰ë™ ë° ê°ì • í‘œì‹œì¤„ -->
                    <div class="action-bar">
                        <span id="disp-action">í–‰ë™: -</span>
                        <span id="disp-emotion">ê°ì •: -</span>
                    </div>
                </div>

                <!-- ìƒíƒœì°½ -->
                <div class="status-section">
                    <div class="location-row">
                        <div class="loc-text">
                            ğŸ“ <span id="disp-loc">ì¥ì†Œ ë¯¸ì •</span>
                        </div>
                        <button class="btn-move" onclick="requestMove()">ì´ë™í•˜ê¸°</button>
                    </div>

                    <div class="stats-grid">
                        <!-- í˜¸ê°ë„ -->
                        <div class="stat-box">
                            <span class="s-label">ğŸ’— í˜¸ê°(U/ë‚¨)</span>
                            <div class="s-val dual">
                                <span class="v-u"><span id="emj-u-fav">ğŸ’”</span><span id="val-u-fav">0</span></span>
                                <span style="margin:0 4px; color:#ddd;">|</span>
                                <span class="v-n"><span id="emj-k-fav">ğŸ’”</span><span id="val-k-fav">0</span></span>
                            </div>
                        </div>
                        <!-- ì˜ì¡´ë„ -->
                        <div class="stat-box">
                            <span class="s-label">ğŸ”— ì˜ì¡´(U/ë‚¨)</span>
                            <div class="s-val dual">
                                <span class="v-u"><span id="emj-u-dep">ğŸ›¡ï¸</span><span id="val-u-dep">0</span></span>
                                <span style="margin:0 4px; color:#ddd;">|</span>
                                <span class="v-n"><span id="emj-k-dep">ğŸ›¡ï¸</span><span id="val-k-dep">0</span></span>
                            </div>
                        </div>
                        <!-- íšŸìˆ˜ -->
                        <div class="stat-box">
                            <span class="s-label">ğŸ’¦ íšŸìˆ˜(U/ë‚¨)</span>
                            <div class="s-val dual">
                                <span class="v-u" id="val-u-cnt">0</span>
                                <span style="margin:0 4px; color:#ddd;">|</span>
                                <span class="v-n" id="val-k-cnt">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- í•˜ë‹¨ ì»¨íŠ¸ë¡¤ -->
                <div class="control-panel">
                    <div class="mode-switch">
                        <div class="mode-btn active" onclick="setMode('emotion')" id="tab-emotion">ğŸ˜Š ê°ì •/ì¼ìƒ</div>
                        <div class="mode-btn" onclick="setMode('action')" id="tab-action">ğŸ” ì„±í–‰ìœ„</div>
                    </div>
                    <div class="code-list-container" id="code-list"></div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // -----------------------------------------------------------
        // 1. ì„¤ì • ë° ë°ì´í„°
        // -----------------------------------------------------------
        const BASE_URL = "https://images.httpskaha.me/FGS/";

        // Situation Codes: 01 ~ 20
        const SITUATION_CODES = [];
        for(let i=1; i<=20; i++) SITUATION_CODES.push(String(i).padStart(2, '0'));

        // Action Codes: 21 ~ 110
        const ACTION_CODES = [];
        for(let i=21; i<=110; i++) ACTION_CODES.push(String(i));

        // Mina (A2) Whitelist
        const MINA_ACTION_CODES = [
            "21", "22", "24", "25", "26", "28", "30", "32", "33", "34", "35", "37", "38", "40", 
            "41", "42", "44", "45", "46", "48", "50", "51", "52", "54", "55", "56", "58", "60", 
            "61", "62", "64", "65", "66", "68", "70", "71", "72", "74", "75", "76", "78", "80", 
            "81", "82", "84", "85", "86", "88", "90", "91", "92", "94", "95", "96", "98", "100", 
            "101", "102", "104", "105", "106", "108", "110"
        ];

        const CHAR_CONFIG = {
            yura:  { name: "ìµœìœ ë¼", code: "A1" },
            mina:  { name: "ê¹€ë¯¼ì•„", code: "A2" },
            minji: { name: "ê¹€ë¯¼ì§€", code: "A3" },
            serin: { name: "í•œì„¸ë¦°", code: "A4" }
        };

        // ğŸŸ¢ [ìƒíƒœ ì €ì¥ì†Œ] ì™¸ë¶€ ë…¸ë“œì—ì„œ ì´ ë³€ìˆ˜ëª…ì„ ë§ì¶°ì£¼ì„¸ìš”.
        let currentState = {
            target: 'yura',
            mode: 'emotion',
            currentImgCode: '01',
            
            data: {
                yura: {
                    location: "ì¹¨ì‹¤", // ì´ˆê¸°ê°’
                    emotion: "ê¸°ë³¸ğŸ˜",
                    action: "ëŒ€ê¸° ì¤‘",
                    u_favorability: 0, k_favorability: 0,
                    u_dependency: 0, k_dependency: 0,
                    u_count: 0, k_count: 0
                },
                mina: {
                    location: "ê±°ì‹¤",
                    emotion: "ê¸°ë³¸ğŸ˜",
                    action: "ëŒ€ê¸° ì¤‘",
                    u_favorability: 0, k_favorability: 0,
                    u_dependency: 0, k_dependency: 0,
                    u_count: 0, k_count: 0
                },
                minji: {
                    location: "ì—°ìŠµì‹¤",
                    emotion: "ê¸°ë³¸ğŸ˜",
                    action: "ëŒ€ê¸° ì¤‘",
                    u_favorability: 0, k_favorability: 0,
                    u_dependency: 0, k_dependency: 0,
                    u_count: 0, k_count: 0
                },
                serin: {
                    location: "ë„ì„œê´€",
                    emotion: "ê¸°ë³¸ğŸ˜",
                    action: "ëŒ€ê¸° ì¤‘",
                    u_favorability: 0, k_favorability: 0,
                    u_dependency: 0, k_dependency: 0,
                    u_count: 0, k_count: 0
                }
            }
        };

        // -----------------------------------------------------------
        // 2. ì´ëª¨ì§€ ê³„ì‚° ë¡œì§
        // -----------------------------------------------------------
        
        // ğŸ’— í˜¸ê° ì´ëª¨ì§€ ê³„ì‚°
        function getFavEmoji(val) {
            const v = parseInt(val) || 0;
            if (v <= 20) return "ğŸ’”"; // ë¬´ê´€ì‹¬/í˜ì˜¤
            if (v <= 50) return "ğŸŒ±"; // ê´€ì‹¬/í˜¸ê¸°ì‹¬
            if (v <= 80) return "ğŸ”¥"; // ì‚¬ë‘/ìš•ì •
            return "ğŸ›";             // ìˆ­ë°°/ë§¹ëª©
        }

        // ğŸ”— ì˜ì¡´ ì´ëª¨ì§€ ê³„ì‚°
        function getDepEmoji(val) {
            const v = parseInt(val) || 0;
            if (v <= 20) return "ğŸ›¡ï¸"; // ìë¦½/ë°˜í•­
            if (v <= 50) return "â›“ï¸"; // ë™ìš”/ê°ˆë“±
            if (v <= 80) return "ğŸ•"; // ë³µì¢…/ìˆœì‘
            return "ğŸ³ï¸";             // ë…¸ì˜ˆí™”/ë¶•ê´´
        }

        // -----------------------------------------------------------
        // 3. ê¸°ëŠ¥ ë° UI ê°±ì‹ 
        // -----------------------------------------------------------

        function changeChar(charKey) {
            currentState.target = charKey;
            currentState.currentImgCode = '01'; // Reset to default situation
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.tab-btn[data-target="${charKey}"]`).classList.add('active');

            const panel = document.getElementById('main-panel');
            panel.classList.remove('yura', 'mina', 'minji', 'serin');
            panel.classList.add(charKey);

            renderUI();
        }

        function setMode(mode) {
            currentState.mode = mode;
            document.getElementById('tab-emotion').classList.toggle('active', mode === 'emotion');
            document.getElementById('tab-action').classList.toggle('active', mode === 'action');
            renderCodeList();
        }

        // ì¥ì†Œ ì´ë™ ìš”ì²­
        function requestMove() {
            const charName = CHAR_CONFIG[currentState.target].name;
            // ì‹¤ì œ ë…¸ë“œ í™˜ê²½ì—ì„œëŠ” ì—¬ê¸°ì„œ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.
            // ì—¬ê¸°ì„œëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ promptë¡œ ê°’ì„ ë°›ì•„ ë‚´ë¶€ ë³€ìˆ˜ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.
            const newLoc = prompt(`[${charName}] ì´ë™í•  ì¥ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”:\n(ë³€ìˆ˜ëª…: location)`, "ìš•ì‹¤");
            
            if(newLoc) {
                // ë°ì´í„° ì—…ë°ì´íŠ¸
                currentState.data[currentState.target].location = newLoc;
                alert(`[System] ì´ë™ ëª…ë ¹ í™•ì¸: ${newLoc}`);
                renderUI(); // í™”ë©´ ì¦‰ì‹œ ê°±ì‹ 
            }
        }

        function selectCode(code) {
            currentState.currentImgCode = code;
            updateImage();
            document.querySelectorAll('.chip-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.code == code);
            });
        }

        function renderUI() {
            const charKey = currentState.target;
            const config = CHAR_CONFIG[charKey];
            const d = currentState.data[charKey];

            // 1. ê¸°ë³¸ ì •ë³´
            setText('disp-name', `${config.name} (${config.code})`);
            setText('disp-loc', d.location || "ì¥ì†Œ ë¯¸ì •");
            setText('disp-emotion', `ê°ì •: ${d.emotion}`);
            setText('disp-action', `í–‰ë™: ${d.action}`);

            // 2. ìˆ˜ì¹˜ ë° ì´ëª¨ì§€ ì ìš©
            // í˜¸ê°ë„
            setText('val-u-fav', d.u_favorability);
            setText('emj-u-fav', getFavEmoji(d.u_favorability));
            setText('val-k-fav', d.k_favorability);
            setText('emj-k-fav', getFavEmoji(d.k_favorability));

            // ì˜ì¡´ë„
            setText('val-u-dep', d.u_dependency);
            setText('emj-u-dep', getDepEmoji(d.u_dependency));
            setText('val-k-dep', d.k_dependency);
            setText('emj-k-dep', getDepEmoji(d.k_dependency));

            // íšŸìˆ˜
            setText('val-u-cnt', d.u_count);
            setText('val-k-cnt', d.k_count);

            updateImage();
            renderCodeList();
        }

        function setText(id, text) {
            const el = document.getElementById(id);
            if(el) el.innerText = text;
        }

        function updateImage() {
            const charKey = currentState.target;
            const config = CHAR_CONFIG[charKey];
            const code = currentState.currentImgCode;
            
            // Determine Type (Situation vs Action)
            let type = "Situation";
            if (parseInt(code) >= 21) type = "Action";
            
            // Format: A1_Situation_01.webp
            const filename = `${config.code}_${type}_${code}.webp`;
            const url = `${BASE_URL}${config.code}/${filename}`;
            
            const imgEl = document.getElementById('disp-img');
            if (imgEl.src !== url) imgEl.src = url;
        }

        function renderCodeList() {
            const container = document.getElementById('code-list');
            container.innerHTML = ''; 

            let list = currentState.mode === 'emotion' ? SITUATION_CODES : ACTION_CODES;

            // Filter for Mina (A2) in Action mode
            if (currentState.target === 'mina' && currentState.mode === 'action') {
                list = list.filter(code => MINA_ACTION_CODES.includes(code));
            }

            list.forEach(code => {
                const btn = document.createElement('div');
                btn.className = 'chip-btn';
                btn.innerText = code;
                btn.dataset.code = code;
                
                if(code == currentState.currentImgCode) btn.classList.add('active');
                if(currentState.mode === 'action') btn.classList.add('nsfw');

                btn.onclick = () => selectCode(code);
                container.appendChild(btn);
            });
        }

        // ğŸ§ª [í…ŒìŠ¤íŠ¸] ì™¸ë¶€ ë…¸ë“œì—ì„œ ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ ì‹œë®¬ë ˆì´ì…˜
        // ì‹¤ì œ ì‚¬ìš© ì‹œ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ì„¸ìš”.
        function updateFromNode(charKey, newData) {
            if(currentState.data[charKey]) {
                // ê¸°ì¡´ ë°ì´í„°ì— ë®ì–´ì“°ê¸°
                Object.assign(currentState.data[charKey], newData);
                // í˜„ì¬ ë³´ê³  ìˆëŠ” ìºë¦­í„°ë¼ë©´ UI ê°±ì‹ 
                if(currentState.target === charKey) renderUI();
            }
        }

        // ì´ˆê¸° ì‹¤í–‰
        renderUI();

    </script>
</body>
</html>